(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,r){"use strict";r.r(t);var a=r(0),o=r.n(a),n=r(8),i=r.n(n),l=r(6),c=r(1),s=r(2),d=r(4),u=r(3),m=r(5),p=function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(d.a)(this,Object(u.a)(t).call(this,e))).onDeviceMotion=function(e){r.setState({dme:e}),r.props.updateAccelerometerValues(e)},r.state={dme:{acceleration:{x:null,y:null,z:null},interval:null},error:!1},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){window.ondevicemotion=this.onDeviceMotion}},{key:"render",value:function(){return o.a.createElement("div",{id:"accelerometer"},o.a.createElement("h3",{className:"title is-3"},"Accelerometer"),o.a.createElement("p",null,"interval for accel: ",this.state.dme.interval),o.a.createElement("p",null,"x: ",this.state.dme.acceleration.x),o.a.createElement("p",null,"y: ",this.state.dme.acceleration.y),o.a.createElement("p",null,"z: ",this.state.dme.acceleration.z))}}]),t}(a.Component),f=function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(d.a)(this,Object(u.a)(t).call(this,e))).updatePosition=function(e){r.setState({position:e}),r.props.updatePosition(e)},r.positionError=function(e){r.setState({error:!0,errorCode:e.code,errorMessage:e.message})},r.state={error:!1,errorCode:null,errorMessage:null,position:{coords:{longitude:null,latitude:null}}},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){null!=navigator.geolocation&&navigator.geolocation.watchPosition(this.updatePosition,this.positionError,{enableHighAccuracy:this.props.enableHighAccuracy,maximumAge:this.props.maximumAge,timeout:this.props.timeout})}},{key:"render",value:function(){return o.a.createElement("div",{id:"gps"},o.a.createElement("h3",{className:"title is-3"},"GPS Coordinates"),o.a.createElement("p",null,"longitude: ",this.state.position.coords.longitude),o.a.createElement("p",null,"latitude: ",this.state.position.coords.latitude),this.state.error&&o.a.createElement("h4",{className:"has-text-danger"},"Error Occurred: ","Error Code "+this.state.errorCode+": "+this.state.errorMessage))}}]),t}(a.Component);null==window.MediaRecorder&&(window.MediaRecorder=r(15));var h=function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(d.a)(this,Object(u.a)(t).call(this,e))).recordAudioStream=function(e){if(r.options={mimeType:"audio/webm"},MediaRecorder.isTypeSupported(r.options.mimeType))r.mediaRecorder=new MediaRecorder(e,r.options);else if(r.options.mimeType="audio/ogg",MediaRecorder.isTypeSupported(r.options.mimeType))r.mediaRecorder=new MediaRecorder(e,r.options);else{if(r.options.mimeType="audio/wav",!MediaRecorder.isTypeSupported(r.options.mimeType))return void r.setState({error:!0,message:"No standard audio codec supported on this device.",code:1});r.mediaRecorder=new MediaRecorder(e,r.options)}r.setState({mimeType:r.options.mimeType}),r.props.newMediaRecorder(r.mediaRecorder,r.options.mimeType)},r.state={error:!1,lastRecorded:null,lastRecordedUrl:null,mimeType:null},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.recordAudioStream)}},{key:"render",value:function(){var e=null;return this.props.recordedAudio&&(e=window.URL.createObjectURL(this.props.recordedAudio)),o.a.createElement("div",{id:"audio"},o.a.createElement("h3",{className:"title is-3"},"Audio Module"),o.a.createElement("p",null,"Recording Codec: ",this.state.mimeType),this.props.recordedAudio&&o.a.createElement("div",null,"audio/webm"!==this.state.mimeType&&o.a.createElement("div",{className:"box"},o.a.createElement("audio",{id:"player",controls:!0,key:e},o.a.createElement("source",{key:e,type:this.options.mimeType,src:e}))),"audio/webm"===this.state.mimeType&&o.a.createElement("div",{className:"box"},o.a.createElement("video",{id:"player",controls:!0,key:e},o.a.createElement("source",{key:e,type:this.state.mimeType,src:e}))),o.a.createElement("a",{className:"button is-info",href:e,download:"audio."+this.state.mimeType.split("/")[1]},"Download Audio Recording")))}}]),t}(a.Component),g=function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(d.a)(this,Object(u.a)(t).call(this,e))).updateLeftError=function(e){var t=e.target.value;r.setState({leftError:t}),"NaN"!==t&&r.props.updateError("left",parseInt(t))},r.updateRightError=function(e){var t=e.target.value;r.setState({rightError:t}),"NaN"!==t&&r.props.updateError("right",parseInt(t))},r.mark=function(){var e=Date.now();r.props.newMark(e),r.setState({lastMark:e})},r.state={error:!1,lastMark:null,leftError:60,rightError:60},r.props.updateError("left",r.state.leftError),r.props.updateError("right",r.state.rightError),r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{id:"marking"},o.a.createElement("h3",{className:"title is-3"},"Marking Module"),o.a.createElement("p",null,"Marks points in recording data while recording all sensors."),o.a.createElement("div",null,o.a.createElement("div",null,"Mark Left Error: "),o.a.createElement("input",{className:"input",type:"number",step:"1",placeholder:"Leftwards Error",value:this.state.leftError,onChange:this.updateLeftError,disabled:this.props.errorDisabled})),o.a.createElement("div",null,o.a.createElement("div",null,"Mark Right Error: "),o.a.createElement("input",{className:"input",type:"number",step:"1",placeholder:"Rightwards Error",value:this.state.rightError,onChange:this.updateRightError,disabled:this.props.errorDisabled})),this.state.lastMark&&o.a.createElement("p",null,"Last Mark: ",new Date(this.state.lastMark).toString()),!this.state.lastMark&&o.a.createElement("p",null,"No marks recorded yet."),o.a.createElement("button",{className:"button is-warning",onClick:this.mark},"Mark"))}}]),t}(a.Component),v=(r(17),r(19),function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(d.a)(this,Object(u.a)(t).call(this,e))).reset=function(){r.recordedAccelerometerValues=[],r.recordedPositionValues=[],r.recordedMarks=[],r.recordedAudioBlobs=[],r.recordedOutput=[],r.fftOutput=[],r.recordedAudioStartTimestamp=null,r.recordedAudioEndTimestamp=null,r.csv=null,r.csvBlob=null,r.fr=new FileReader,r.fr.addEventListener("error",function(e){console.log(e)}),r.counter=0,r.lastMark=null},r.updateAccelerometerValues=function(e){r.accelerometerValues=e,r.state.recording&&r.recordedAccelerometerValues.push([Date.now(),e.acceleration.x,e.acceleration.x,e.acceleration.z])},r.updatePosition=function(e){r.position=e,r.state.recording&&r.recordedPositionValues.push([Date.now(),e.coords.longitude,e.coords.latitude])},r.newMediaRecorder=function(e,t){r.mediaRecorder=e,r.mimeType=t,r.mediaRecorder.addEventListener("stop",r.saveRecording),r.mediaRecorder.addEventListener("error",function(e){console.log("error in recording audio from mic")}),r.mediaRecorder.addEventListener("dataavailable",function(e){e.data.size>0?r.pushNewAudioBlob(e.data,e):(r.pushNewAudioBlob(e.data,e),console.log("error in recording maybe"),console.log(e))})},r.pushNewAudioBlob=function(e,t){r.recordedAudioBlobs.push(e)},r.newMark=function(e){r.lastMark=e,r.state.recording&&r.recordedMarks.push(e)},r.updateMarkError=function(e,t){"left"===e?r.markLeftError=t:"right"===e&&(r.markRightError=t)},r.toggleRecording=function(){if(r.state.recording)r.mediaRecorder.stop(),r.setState({recording:!1});else{r.reset(),r.setState({recordedAudio:null,recordedAudioURL:null,csv:null});var e=Date.now();r.recordedAudioStartTimestamp=e,r.recordedAccelerometerValues.push([e,r.accelerometerValues.acceleration.x,r.accelerometerValues.acceleration.y,r.accelerometerValues.acceleration.z]),r.recordedPositionValues.push([e,r.position.coords.longitude,r.position.coords.latitude]),r.mediaRecorder.start(r.blobLengthMS),r.setState({recording:!0})}},r.saveRecording=function(){r.recordedAudioEndTimestamp=Date.now();var e=new Blob(r.recordedAudioBlobs,{type:r.mimeType});r.setState({recordedAudio:e}),r.processRecording(e)},r.processRecording=function(e){r.fr.addEventListener("load",function(e){(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(r.fr.result,function(e){var t=null;window.OfflineAudioContext?t=new window.OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate):window.webkitOfflineAudioContext?t=new window.webkitOfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate):r.setState({error:!0,errorCode:2,errorMessage:"Offline Audio Context not supported by this device."});var a=t.createBufferSource();r.analyser=t.createAnalyser(),a.buffer=e;for(var o=2048;1/(e.sampleRate/o)>=.003&&512!==o;)o/=2;r.analyser.fftSize=o;var n=t.createScriptProcessor(r.analyser.fftSize,e.numberOfChannels,e.numberOfChannels);a.connect(r.analyser),r.analyser.connect(n),n.connect(t.destination),n.onaudioprocess=r.processSample,a.start(),t.oncomplete=function(e){r.formatData(r.recordedAccelerometerValues,r.recordedPositionValues,r.fftOutput,r.recordedMarks,r.recordedAudioStartTimestamp,r.recordedAudioEndTimestamp)},t.startRendering()},function(e){console.log("error decoding audio"),console.log(e)})}),r.fr.readAsArrayBuffer(e)},r.processSample=function(e){r.counter++;var t=r.analyser.frequencyBinCount,a=new Uint8Array(t);r.analyser.getByteFrequencyData(a),r.fftOutput.push(a)},r.formatData=function(e,t,a,o,n,i){var c=i-n,s=parseFloat(c)/parseFloat(a.length),d=[],u=0,m=0,p=0,f=s;r.labels=["timestamp_ms","acceleration_x","acceleration_y","acceleration_z","latitude","longitude"];for(var h=0;h<a[0].length;h++)r.labels.push("FFT_bin_"+(h+1));r.labels.push("marked");for(var g=0;g<c;g++){var v=n+g,E=e[u],b=t[m],y=a[p];d.push([v].concat(Object(l.a)(E.slice(1)),Object(l.a)(b.slice(1)),Object(l.a)(y),[0]));var w=v+1;u<e.length-1&&E[u+1][0]<=w&&u++,m<t.length-1&&b[m+1][0]<=w&&m++,g>=parseInt(f)&&(f+=s,p++)}var A=!0,R=!1,k=void 0;try{for(var M,O=o[Symbol.iterator]();!(A=(M=O.next()).done);A=!0){var S=M.value-n,j=S-r.markLeftError;j<0&&(j=0);var x=S+r.markRightError;x>=d.length&&(x=d.length-1);for(var C=j;C<=x;C++)d[C][r.labels.length-1]=1}}catch(N){R=!0,k=N}finally{try{A||null==O.return||O.return()}finally{if(R)throw k}}r.formattedData=d,r.createCSV(r.formattedData,r.labels)},r.createCSV=function(e,t){var a="";a+=t.join(",")+"\r\n",e.forEach(function(e){a+=e.join(",")+"\r\n"}),r.csv=a,r.csvBlob=new Blob([r.csv],{type:"text/csv"}),r.setState({csv:window.URL.createObjectURL(r.csvBlob)})},r.state={mic:null,recording:!1,recordedAudio:null,recordedAudioURL:null,error:!1,csv:null},r.accelerometerValues={acceleration:{x:null,y:null,z:null}},r.position={coords:{latitude:null,longitude:null}},r.reset(),r.blobLengthMS=null,r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},this.state.error&&o.a.createElement("h1",{className:"is-1 has-text-danger"},"ERROR"),o.a.createElement("div",{className:"box"},o.a.createElement(p,{updateAccelerometerValues:this.updateAccelerometerValues})),o.a.createElement("div",{className:"box"},o.a.createElement(f,{updatePosition:this.updatePosition,enableHighAccuracy:!0,maximumAge:0,timeout:1})),o.a.createElement("div",{className:"box"},o.a.createElement(h,{recordedAudio:this.state.recordedAudio,newMediaRecorder:this.newMediaRecorder})),o.a.createElement("div",{className:"box"},o.a.createElement(g,{newMark:this.newMark,updateError:this.updateMarkError,errorDisabled:this.state.recording})),o.a.createElement("div",{className:"box"},o.a.createElement("h3",{className:"title is-3"},"Record All Sensors"),o.a.createElement("button",{className:"button is-danger",onClick:this.toggleRecording},this.state.recording?this.state.recording&&"Stop":"Start"," Recording"),null!=this.state.csv&&o.a.createElement("div",null,o.a.createElement("a",{className:"button is-info",href:this.state.csv,download:"results.csv"},"Download csv of all sensor data"))))}}]),t}(a.Component));i.a.render(o.a.createElement(v,null),document.getElementById("root"))},9:function(e,t,r){e.exports=r(21)}},[[9,2,1]]]);
//# sourceMappingURL=main.c57a9985.chunk.js.map